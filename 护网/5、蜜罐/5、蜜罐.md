# HFish

```
HFish是一款社区型免费蜜罐，侧重企业安全场景，从内网失陷检测、外网威胁感知、威胁情报生产三个场景出发，为用户提供可独立操作且实用的功能，通过安全、敏捷、可靠的中低交互蜜罐增加用户在失陷感知和威胁情报领域的能力。

HFish具有超过40种蜜罐环境、提供免费的云蜜网、可高度自定义的蜜饵能力、一键部署、跨平台多架构、国产操作系统和CPU支持、极低的性能要求、邮件/syslog/webhook/企业微信/钉钉/飞书告警等多项特性，帮助用户降低运维成本，提升运营效率。

```

## 1．HFish的优点 为什么选择HFish

```
            1）.免费、简单、安全的蜜罐产品
蜜罐通常被定义为具有轻量级检测能力、低误报率的检测产品，同时它也是企业生产本地威胁情报的优质来源之一。HFish 可以帮助中小型企业用户在日常安全运营中进行避免告警洪水、低成本的增加威胁感知和情报生产能力。目前，社区的力量正在不断帮助HFish完善自身，共同探索欺骗防御的最佳实践。
            2）. 安全、敏捷的威胁感知节点
 HFish被广泛应用于感知办公内网、生产环境、云内网及其他环境失陷主机横向移动、员工账号外泄、扫描和探测行为、私有情报生产甚至内部演练和安全意识培训，HFish的多种告警输出形式与态感、NDR、XDR或日志平台结合，极大拓展检测视野。
```



1. ## HFish 架构

```
HFish采用B/S架构，系统由管理端和节点端组成，管理端用来生成和管理节点端，并接收、分析和展示节点端回传的数据、节点端接受管理端的控制并负责构建蜜罐服务。
在HFish 中，管理端只用于数据的分析和展示，节点端进行虚拟蜜罐，最后由蜜罐来承受攻击。
```

## 3．HFish的安装

```
（1）在线一键安装
请防火墙开启4433、4434，确认返回success（如之后蜜罐可使用相同命令打开。）
firewall-cmd --add-port=4433/tcp --permanent   #(用于web界面启动)
firewall-cmd --add-port=4434/tcp --permanent   #(用于节点与管理端通信)
firewall-cmd --reload
使用root用户，运行下面的脚本。
bash <(curl -sS -L https://hfish.net/webinstall.sh)

firewall-cmd --query-port=8848/tcp      #查看端口是否开启

（2）离线安装
在官网下载离线安装包
在当前目录下创建一个路径解压安装包
mkdir hfish
将安装文件包解压到hfish目录下
tar -zxvf hfish-3.1.4-linux-amd64.tgz -C hfish
请防火墙开启4433、4434和7879，确认返回 success
firewall-cmd --add-port=4433/tcp --permanent
firewall-cmd --add-port=4434/tcp --permanent
firewall-cmd --add-port=7879/tcp --permanent
进入安装目录直接运行install.sh
sudo ./install.sh

第六步：登陆web界面
登陆链接：https://[ip]:4433/web/
账号：admin
密码：HFish2021

```



## 4．HFlsh的使用

### 4.1 HFish 基本结构

```
HFish由管理端（server）和节点端（client）组成，管理端用来生成和管理节点端，并接收、分析和展示节点端回传的数据，节点端接受管理端的控制并负责构建蜜罐服务。
```

### 4.2 HFish 各模块关系

```
HFish管理端:
                    查看攻击日志
                    查看扫描记录
                    查看攻击手法
                    进行攻击溯源
                    告警

HFish节点端:

                    暴露在外，感知攻击
```



### 5. 节点

```
安装HFish＿管理端后，默认在管理端所在机器上建立节点感知攻击，该节点被命名为「内置节点」。
该节点将默认开启部分服务，包括FTP、SSH、Telnet、Zabbix监控系统、Nginx蜜罐、
MySQL蜜罐、Redis蜜罐、HTTP代理蜜罐、ElasticSearch蜜罐和通用TCP端口监听。在节点机器执行命令语句或安装包，即可成功部署节点。
```



1. ### 删除节点

```
进入【节点管理】页面，在节点列表中找到要删除的节点，点击该节点右侧【删除】，HFish需要二次验证您的管理员身份，输入admin密码后，节点将被删除。
节点被删除后：
节点端进程会自动退出，但程序会保留原有路径，需要二次手动删除。
所有攻击数据不会丢失，仍然能在所有数据中进行查看。
```



### 7．攻击查看

当前，HFish提供四个不同的页面进行攻击信息查看，分别为：

```
攻击列表
扫描感知
失陷感知
攻击来源
账号资产
样本检测
威胁检测。
```



### 攻击列表：

```
收集所有对蜜罐的攻击；节点部署蜜罐后，攻击者对蜜罐的所有攻击信息都会被收录到「攻击列表」中。

该页面用于展示，聚合，搜索，分析和导出HFish蜜罐捕获攻击数据的页面。
攻击列表本身有一定的聚合能力，会把一段时间内，针对同一IP、同一蜜罐的同一攻击者行为聚合在一起。
本页面展示的攻击数据有：
1、被攻击蜜罐名称 
2、被攻击数量 
3、被攻击节点名称
4、攻击来源IP和地理位置
5、威胁情报
6、最后一次攻击时间
7、攻击时间
8、攻击数据长度 
9、攻击详情

用户还可以按照攻击来源IP地址、蜜罐场景、蜜罐类型、被攻击节点名称、数据长度、攻击来源地理位置名称、情报标签和是否标记进行搜索，支持按照攻击时间或数量排序支持导出所有攻击数据或导出某个聚合事件到CSV文件。
```



### 扫描感知：

```
收集了节点机器网卡的所有连接信息；节点生成之后，HFish会记录对节点所有网卡的连接，包括来所有连访IP，连接IP和端口。

该页面用于展示HFish蜜罐节点被TCP、UDP和ICMP三种协议的全端口扫描探测行为。
即使节点相关端口没有开放，HFish 仍能记录下扫描行为，此外，HFish还会记录节点
主机本身外联行为。
目前扫描感知列表内能够展示的信息如下：
1、扫描IP
2、威胁情报 
3、被扫描节点
4、被扫描IP 
5、扫描类型 
6、被扫描端口
7、节点位置
8、扫描开始时间 
9、扫描持续时间 
```

### 攻击来源：

```
收集了所有连接和攻击节点的IP信息；所有尝试连接和攻击节点的IP信息都被记录在攻击来源中，如果蜜罐溯源和反制成功，信息也会被记录其中。
```

### 账号资产：

```
收集了所有攻击者破解蜜罐使用的账号和密码；HFish 会提取攻击者对SSH、以及所有Web“蜜罐登陆所使用攻击者破解的账号密码”，进行统一展示。同时，用户可“自定义监控词汇”，如员工姓名，公司名称等，一旦与攻击者使用的账号重合，可以高亮显示并警告。
```

### 失陷感知：

```
该页面是利用已经播撒的蜜饵实现主机失陷感知威胁，用户可以在该页面生成蜜饵，并观测蜜饵被触碰状态。
```

### 什么是蜜饵？

```
蜜饵泛指任意伪造的高价值文件（例如运维手册、邮件、配置文件等），用于引诱和转移
攻击者视线，最终达到牵引攻击者离开真实的高价值资产并进入陷阱的目的。
使用场景：
HFish的蜜饵在 牵引 攻击者的功能上增加了 精确定位失陷 能力，即每个蜜饵都是唯一的，攻击者入侵用户主机后，如果盗取蜜饵文件中的数据并从任意主机发起攻击，防守者仍能知道失陷源头在哪里。

举个例子：
攻击者侵入企业内部某台服务器，在其目录中找到一个payment＿config.ini 文件，文件中包含数据库主机IP地址和账号密码，

HFish 的蜜饵
HFish 的蜜饵模块由 蜜饵定制 、分发接口 和 告警信息 三部分组成。

蜜饵定制
HFish.提供完整的蜜饵定制，可以通过在「失陷感知」—「失陷感知」中定制新增自己的业务蜜饵。
在蜜饵内容中，Susername＄、＄password＄和＄honeypot＄分别代表账号、密码和蜜罐变 量，以上为必填变量，必须进行引用，才能让蜜饵功能生效。三个变量，按照文件想呈现
给攻击者的效果进行引用。＄username＄变量如果未填写账号字典，则默认用root作为所有
蜜饵的账号名。＄password＄变量按照选取的位数，自动生成蜜饵的密码。＄honeypot＄变量按照蜜饵下拉节点的部署服务，自动生成IP和端口。
```

### 账号资产：

```
该页面用于收集所有被用来攻击的账号密码，通过配置可对企业失陷账号进行有效监控。通过设定高级监测策略，辅助企业进行失陷账号监控，建议输入企业邮箱、企业域名、员工姓名等信息，随时监控泄漏。
```

### 攻击来源：

```
该页面用于通过汇聚本地蜜罐感知、云端情报、用户自定义情报和溯源反制获得的信息来刻画攻击者画像，成为企业的私有情报库。
```

### 样本检测

```
该页面用于展示HFish在高交互蜜罐（高交互ssh和高交互 telnet蜜罐）中，捕获到的攻击者 上传/下载到服务器中的样本。
所有样本都会上传到免费的微步在线沙箱（https://s.threatbook.cn/）中，进行样本检测，并将结果返回。该检测不花费用户检测次数。
```

### 威胁检测

```
                                        检测功能简介 
适用情况:
本地默认自带规则，通过设置自定义规则，可对关注的重点攻击行为做实时监控。在重大保障／攻防演练中，当有0day、Nday等漏洞爆出，可自定义添加对应漏洞的yara规则，重点监控。另威胁检测引擎会发现触发这些规则的告警，这些告警可帮助判断针对性攻击。
检测数据：
HFish的威胁检测引擎是基于攻击HFish的日志数据进行检测。日志原始数据可以查看攻击列表；
这些数据包括有web蜜罐的url数据、UA等数据，高交互蜜罐内执行的命令等数据，普通蜜罐的记录日志。
```

### 朔源： 什么是溯源？

```
溯源，一般是在攻防中，用于挖掘攻击者身份，通过资产面，回溯等判断攻击者身份。在近几年攻防演练中，更加特指了解对方的身份信息。

HFish作为蜜罐软件，提供被攻击时候的正常防卫需求。当攻击者扫描、攻击或者恶意连接HFish的蜜罐时，HFish提供包括但不限于：通过现有攻击工具漏洞，在合理范围内对攻击者进行信息提取、溯源等必要的攻击防御信息收集手段。
溯源实现原理与测试方法

HFish共支持三种溯源手段。

```

#### 1．Mysql反制（支持内网，能够对攻击者机器做任意文件读取）

```
通过MySql．客户端漏洞，当攻击者使用8.0以下的Mysql客户端直连HFish的Mysql蜜罐的时候。可以触发任意文件读取的能力，读取Mysql客户端所在机器上的任意一个文件。

PS:
一定是Mysql客户端直连。不兼容诸如navicat这类工具。
节点管理中，可以设置mysql任意文件读取的具体读取路径。
```

#### 2．厂商vpn蜜罐反制（支持内网，能够获得windows机器登陆的微信号信息与桌面截图）

```
通过蜜罐页面提供可下载二进制，攻击者下载执行后，会获取攻击者的微信与屏幕截图该部分记录的是连接IP，所以您在内网中测试，测试结果不会回传到云端共享，可放心测试。
测试步骤:
        a.直接在HFish 中添加深信服vnn蜜罐。
        b.下载蜜罐页面中的exe 并运行、
        c.进入攻击来源，搜索IP或者直接点击溯源信息按钮。
```

#### 3．web型蜜罐溯源（不支持内网溯源）

```
HFish所有的web页面蜜罐，包括自定义蜜罐，都可以在该情况下进行溯源。
对扫描器、webshell管理器、java反序列化反制。该部分反制数据会显示攻击者的出口IP。可以拿到包括机器架构、微信账号、QQ账号、QQ音乐账号、百度云账号，浏览器浏览记录、history、whoami等信息
注意：处于对产品技术保密的原因。我们不会公开可以对扫描器、webshell＿管理器能够进行溯源反制，也不会提供相关的应用教程。
如果您确实有测试需求，请用您的企业邮箱，说明您的公司，身份，测试需求原因，邮件honeypot＠threatbook.cn发送申请。我们只支持企业安全部门的测试申请与协助。
```

#### 4 ．Java 远程调用蜜罐溯源（不支持内网溯源）

```
Java远程调用蜜罐是HFish内置的一种蜜罐服务。添加到节点上即可使用
当攻击者使用java反序列化工具对你的Java远程调用蜜罐进行攻击时，由于该蜜罐内置了Java反序列化工具的漏洞利用方式。
因此可以拿到包括机器架构、微信账号、QQ账号、QQ音乐账号、百度云账号，浏览器浏览记录、history、whoami等信息。

测试：
首先我们开启页面节点页面，在节点中添加深信服vpn蜜罐

实验：使用namp扫描蜜罐查看扫描信息
root/kali:
sudo nmap -sS -p 1-65535 -v 192.168.234.137
```
