# 一、网络的重要性

```
所有的系统都有网络！ 我们的生活已经离不开网络，越来越多的设备都接入到了互联网。 网络上充斥着各种攻击行为，还有很多是避不开的攻击，所以学习网络安全，必然要学习一下网络。
```



#  二、网络设备介绍

```
多数笔记本都是有两种网卡，有线网卡和无线网卡，手机内置无线网卡。 
    有线网卡
    无线网卡
    路由器
    交换机
	光猫
	宽带运营商

光猫是一种调制解调器，是光调制解调器，主要作用是将光信号转化为电信号，如果入户线是光纤的，那么需要光猫来将光信号转换为电信号，然后连接路由器，其他终端设备连接路由器来上网，很多光猫也带有路由器的功能，但是一般不太好用，所以一般都是建议光猫和路由器一起来使用，各司其职。
如果入户线不是光纤，那么只要有个路由器就可以直接上网了。

	
运营商是指提供网络服务的供应商，如华为、中兴、诺基亚、爱立信等这些通信设备的生产厂家叫生产
商，而中国移动、中国联通、中国电信、 中国广电这些公司叫运营商。

现在的网线基本都是568b规格的，8根线，4根上传4根下载，也叫做双绞线。wifi现在做的也越来越好
了，wifi6和wifi6E的速度都很快了，wifi7也快发布了。可以看一下wifi的前世今生。wifi信号其实就是电磁波或者无线电信号。
```

![image-20240525151308668](D:/%E6%96%87%E6%A1%A3/%E7%AC%94%E8%AE%B0/%E5%AD%A6%E6%A0%A1/Hadoop/image-20240525151308668.png)

![image-20240525151318744](D:/%E6%96%87%E6%A1%A3/%E7%AC%94%E8%AE%B0/%E5%AD%A6%E6%A0%A1/Hadoop/image-20240525151318744.png)

![image-20240525151333755](D:/%E6%96%87%E6%A1%A3/%E7%AC%94%E8%AE%B0/%E5%AD%A6%E6%A0%A1/Hadoop/image-20240525151333755.png)

![image-20240525151348583](D:/%E6%96%87%E6%A1%A3/%E7%AC%94%E8%AE%B0/%E5%AD%A6%E6%A0%A1/Hadoop/image-20240525151348583.png)

![image-20240525151357813](D:/%E6%96%87%E6%A1%A3/%E7%AC%94%E8%AE%B0/%E5%AD%A6%E6%A0%A1/Hadoop/image-20240525151357813.png)

![image-20240525151412165](D:/%E6%96%87%E6%A1%A3/%E7%AC%94%E8%AE%B0/%E5%AD%A6%E6%A0%A1/Hadoop/image-20240525151412165.png)

![image-20240525151425718](D:/%E6%96%87%E6%A1%A3/%E7%AC%94%E8%AE%B0/%E5%AD%A6%E6%A0%A1/Hadoop/image-20240525151425718.png)





## 网络通信问题：

```
设备带宽：各个设备之间进行网络数据传输，那么如果电脑网卡是千兆网卡，而路由器是百兆路由器，那么上
网的最高速度也就是百兆，千兆网卡就浪费了。
通信介质：电磁波、光纤等。
多操作系统：各种操作系统信号兼容问题。
目标：信号发送和信号接收，要解决目标问题。
目标程序：qq对qq，微信对微信等等，需要用网络的程序很多，还要解决多个软件同时使用网络的问题。
保密：传输信号保密问题。
...
```

# 三、osi 7层模型

![image-20240525151504132](D:/%E6%96%87%E6%A1%A3/%E7%AC%94%E8%AE%B0/%E5%AD%A6%E6%A0%A1/Hadoop/image-20240525151504132.png)

![image-20240525151514952](D:/%E6%96%87%E6%A1%A3/%E7%AC%94%E8%AE%B0/%E5%AD%A6%E6%A0%A1/Hadoop/image-20240525151514952.png)

## 1、物理层

```
物理层 ：解决信号转换的问题，基本都是数字信号，二进制数据控制的电路信号、电磁信号：电信号、
光纤(光信号：光纤网卡可以将电信号转换为光信号)、电磁波。这个基本不需要我们关注，设备厂商就帮
我们解决了。
```

## 2、数据链接层

```
每块网卡(有线、无线、蓝牙等)每块网卡出厂时都被烧制上一个世界唯一的mac地址，长度为48位2进
制，通常由12位16进制数表示（前六位是厂商编号，后六位是流水线号），通过mac地址就可以查询到
它对应的厂商。这个mac地址是入网许可证，没有mac地址，就不能上网。
```

```
Realtek叫做瑞昱，图标是个小螃蟹，是专门生产网卡和声卡的厂商。
Realtek Gaming GBE Family Controller
Realtek:瑞昱
Gaming: 专门为游戏本设计的网卡
GBE : 表示我的网卡是千兆网卡，如果没看到这个，说明可能是百兆网卡。
```

```
mac地址主要是用来解决网络通信的目标问题的，可以让信号传输的时候找到正确的网卡，不会把数据
发乱目标。
```

## 3、网络层

```
网络层，主要是用来封装ip地址的，公网ip全世界唯一，私网ip(也叫做内网ip)。

ip地址主要用来做目标定位。公网ip地址有点像酒店地址，私有ip地址像酒店中的各个房间号，每个酒店可能都有这个房间号，但是每个酒店的具体位置肯定是不同的。那么和mac地址有什么区别呢？mac地址有点像人的身份证号，但是我怎么找到这个人呢？要先找到它的地址，这个地址就是ip地址。所有人上网都需要一个公网ip地址。
世界上有个组织专门分配ip地址，这个组织叫做IANA，IANA(The Internet Assigned Numbers Authority，互联网数字分配机构)，ip、域名等都归它来管理
```

## 4、传输层

传输方式tcp/udp，发送数据包的方式，比如发快递：空运、货车、火车等等。

```
tcp：可靠的(网络传输要经过很多设备，或者信号不好收不到数据包，tcp发给你发送数据包比较大，那么可能会分多个数据包发送，单个数据包大小为1500B，大数据包拆分成多个小数据包，每个小数据包打上编号，每发送一个包都要和对方确认，对方只有告诉我收到了，才会继续发送，没收到的话就补发、再发，最终所有的数据包都发送完成之后，多个小数据包根据编号来组成大数据文件，因为要来回确认，所以慢)，速度慢

udp：不可靠的(我就使劲儿给你发，不需要你确认，可能会丢包)，速度快，直播、视频等，局域网用的多一些，比如feiq、vnc等
```

```
端口概念，英文为port：ssh的22端口、网站的80端口、vnc的5900端口等等，每个需要对外通信的
软件，系统都会给他分配一个端口，有些端口是软件自己指定好的。
```

通过指令可以查看到运行程序的端口的

```bash
 netstat -ano 
 netstat -lntup
```

## 5、应用层

### 5.1 会话层

```
会话层会发送一个探测数据包，探测双方网络是否能互通。会话的建立和断开都是由这一层的数据控制
的。
```

### 5.2 表示层

```
用来描述文件的类型，比如我们在网上发送了一个图片、文本、视频等等格式。表示层会在发送的整体
二进制数据前面加上文件类型数据标记。数据加密、数据格式声明的数据都是在这一层。
```

### 5.3 应用层

```
就是我们各类应用软件了，qq、浏览器、微信、网易云等等。
tcp/ip五层协议是用到额最广泛的，只要大家电脑上安装了这个协议，就可以基于这个协议来进行通信
了。
tcp/ip协议栈分为5层协议。应用层(会话层、表示层和应用层这三层合并为了一层)、传输层、网络层、
数据链路层、物理层。
```

# 四、数据的封装和解封装

```
数据包看到了5层协议数据。

应用层--->数据  ，比如5M的图片数据 

传输层--->tcp报头+数据  tcp报头+小数据包1 、tcp报头+小数据包2 、tcp报头+小数据包3... 

网络层--->ip包(ip地址)+tcp报头+数据1、ip包(ip地址)+tcp报头+数据2、ip包(ip地址)+tcp报头+数据3... 

数据链接层===>数据帧(mac地址)+ip包+tcp报头+数据1、数据帧(mac地址)+ip包+tcp报头+数据2、数
据帧(mac地址)+ip包+tcp报头+数据3... 

物理层===>将完整的数据包，由二进制转换成电信号



接收方正好反过来
传输层： tcp报头+小数据包1 、tcp报头+小数据包2 、tcp报头+小数据包3..收集起来，在网卡那里就收集好了，所以网卡是占用一部分内存空间的。
```

# 五、tcp三次握手，四次挥手

我们知道网络层，可以实现两个主机之间的通信。但是这并不具体，因为，真正进行通信的实体是在主 机中的进程，是一个主机中的一个进程与另外一个主机中的一个进程在交换数据。IP协议虽然能把数据 报文送到目的主机，但是并没有交付给主机的具体应用进程。而端口对端口的通信才应该是应用进程之 间的通信。

```
UDP，在传送数据前不需要先建立连接，远地的主机在收到UDP报文后也不需要给出任何确认。虽然UDP
不提供可靠交付，但是正是因为这样，省去和很多的开销，使得它的速度比较快，比如一些对实时性要求较高的服务，就常常使用的是UDP。对应的应用层的协议主要有DNS,TFTP,DHCP,SNMP,NFS等。

TCP，提供面向连接的服务，在传送数据之前必须先建立连接，建立连接就是确保双方的网络是通畅的，
数据传送完成后要释放连接，而且每发送一个数据包都要收到确认信息才会发送另外一个数据包。因此TCP是一种可靠的的运输服务，但是正因为这样，不可避免的增加了许多的开销，所以速度相比UDP就慢一些，比如确认，流量控制等。对应的应用层的协议主要有 SMTP,TELNET,HTTP,FTP等.
```

**常用的端口号：**

![image-20240525152144951](D:/%E6%96%87%E6%A1%A3/%E7%AC%94%E8%AE%B0/%E5%AD%A6%E6%A0%A1/Hadoop/image-20240525152144951.png)

 TCP是我们重点讲解的协议，因为和安全息息相关。
 TCP协议在发送数据包的时候，会发送多种类型的数据包，每种数据包都有特殊的意义，每个中数据包
都会在数据包里面添加上特定的标识数据来表示数据包的意义，比如：

```
SYN  建立链接
ACK  回应标识
FIN  断开链接
PSH  数据包
RST  紧急指针
URG  重置（重传）  网络不稳定的时候会看到好多重发包
```

**TCP建立连接需要三次握手**

```
1、TCP服务器进程先创建传输控制块TCB，时刻准备接受客户进程的连接请求，此时服务器就进入了LISTEN（监听）状态；

2、TCP客户进程也是先创建传输控制块TCB，然后向服务器发出连接请求报文，这是报文首部中的同部位
SYN=1，同时选择一个初始序列号 seq=x ，此时，TCP客户端进程进入了 SYN-SENT（同步已发送状态）状态。TCP规定，SYN报文段（SYN=1的报文段）不能携带数据，但需要消耗掉一个序号。

3、TCP服务器收到请求报文后，如果同意连接，则发出确认报文。确认报文中应该 ACK=1，SYN=1，确认号是ack=x+1，同时也要为自己初始化一个序列号 seq=y，此时，TCP服务器进程进入了SYN-RCVD（同步收到）状态。这个报文也不能携带数据，但是同样要消耗一个序号。

4、TCP客户进程收到确认后，还要向服务器给出确认。确认报文的ACK=1，ack=y+1，自己的序列号
seq=x+1，此时，TCP连接建立，客户端进入ESTABLISHED（已建立连接）状态。TCP规定，ACK报文段可以携带数据，但是如果不携带数据则不消耗序号。

5、当服务器收到客户端的确认后也进入ESTABLISHED状态，此后双方就可以开始通信了。 
```

**为什么TCP客户端最后还要发送一次确认呢？**

```
一句话，主要防止已经失效的连接请求报文突然又传送到了服务器，从而产生错误。
如果使用的是两次握手建立连接，假设有这样一种场景，客户端发送了第一个请求连接并且没有丢失，只是因为在网络结点中滞留的时间太长了，由于TCP的客户端迟迟没有收到确认报文，以为服务器没有收到，此时重新向服务器发送这条报文，此后客户端和服务器经过两次握手完成连接，传输数据，然后关闭连接。此时此前滞留的那一次请求连接，网络通畅了到达了服务器，这个报文本该是失效的，但是，两次握手的机制将会让客户端和服务器再次建立连接，这将导致不必要的错误和资源的浪费。
如果采用的是三次握手，就算是那一次失效的报文传送过来了，服务端接受到了那条失效报文并且回复了确认报文，但是客户端不会再次发出确认。由于服务器收不到确认，就知道客户端并没有请求连接。
```

**握手建立连接之后，就开始发送真实数据了。**

```
断开连接需要四次挥手，数据传输完毕后，双方都可释放连接。最开始的时候，客户端和服务器都是处 于ESTABLISHED状态，然后客户端主动关闭，服务器被动关闭。服务端也可以主动关闭。
```

```
1、客户端进程发出连接释放报文，并且停止发送数据。释放数据报文首部，FIN=1，其序列号为seq=u（等于前面已经传送过来的数据的最后一个字节的序号加1），此时，客户端进入FIN-WAIT-1（终止等待1）状态。 TCP规定，FIN报文段即使不携带数据，也要消耗一个序号。

2、服务器收到连接释放报文，发出确认报文，ACK=1，ack=u+1，并且带上自己的序列号seq=v，此时，服务端就进入了CLOSE-WAIT（关闭等待）状态。TCP服务器通知高层的应用进程，客户端向服务器的方向就释放了，这时候处于半关闭状态，即客户端已经没有数据要发送了，但是服务器若发送数据，客户端依然要接受。这个状态还要持续一段时间，也就是整个CLOSE-WAIT状态持续的时间。

3、客户端收到服务器的确认请求后，此时，客户端就进入FIN-WAIT-2（终止等待2）状态，等待服务器发送连接释放报文（在这之前还需要接受服务器发送的最后的数据）。

4、服务器将最后的数据发送完毕后，就向客户端发送连接释放报文，FIN=1，ack=u+1，由于在半关闭状态，服务器很可能又发送了一些数据，假定此时的序列号为seq=w，此时，服务器就进入了LAST-ACK（最后确认）状态，等待客户端的确认。

5、客户端收到服务器的连接释放报文后，必须发出确认，ACK=1，ack=w+1，而自己的序列号是seq=u+1，此时，客户端就进入了TIME-WAIT（时间等待）状态。注意此时TCP连接还没有释放，必须经过2∗∗MS（最长报文段寿命）的时间后，当客户端撤销相应的TCB后，才进入CLOSED状态。

6、服务器只要收到了客户端发出的确认，立即进入CLOSED状态。同样，撤销TCB后，就结束了这次的TCP连接。可以看到，服务器结束TCP连接的时间要比客户端早一些
```

**为什么客户端最后还要等待2MSL？**

```
MSL（Maximum Segment Lifetime），TCP允许不同的实现可以设置不同的MSL值。
第一，保证客户端发送的最后一个ACK报文能够到达服务器，因为这个ACK报文可能丢失，站在服务器的角度看来，我已经发送了FIN+ACK报文请求断开了，客户端还没有给我回应，应该是我发送的请求断开报文它没有收到，于是服务器又会重新发送一次，而客户端就能在这个2MSL时间段内收到这个重传的报文，接着给出回应报文，并且会重启2MSL计时器。

第二，防止类似与“三次握手”中提到了的“已经失效的连接请求报文段”出现在本连接中。客户端发送完最后一个确认报文后，在这个2MSL时间中，就可以使本连接持续的时间内所产生的所有报文段都从网络中消失。这样新的连接中不会出现旧连接的请求报文。
```

**为什么建立连接是三次握手，关闭连接确是四次挥手呢？**

```
1、建立连接的时候， 服务器在LISTEN状态下，收到建立连接请求的SYN报文后，把ACK和SYN放在一个报文里发送给客户端。 
2、而关闭连接时，服务器收到对方的FIN报文时，仅仅表示对方不再发送数据了但是还能接收数据，而自己也未必全部数据都发送给对方了，所以己方可以立即关闭，也可以发送一些数据给对方后，再发送FIN报文给对方来表示同意现在关闭连接，因此，己方ACK和FIN一般都会分开发送，从而导致多了一次。
```

**如果已经建立了连接，但是客户端突然出现故障了怎么办？**

```
TCP还设有一个保活计时器，显然，客户端如果出现故障，服务器不能一直等下去，白白浪费资源。服务器每收到一次客户端的请求后都会重新复位这个计时器，时间通常是设置为2小时，若两小时还没有收到客户端的任何数据，服务器就会发送一个探测报文段，以后每隔75分钟发送一次。若一连发送10个探测报文仍然没反应，服务器就认为客户端出了故障，接着就关闭连接。 
```

![image-20240525153247127](D:/%E6%96%87%E6%A1%A3/%E7%AC%94%E8%AE%B0/%E5%AD%A6%E6%A0%A1/Hadoop/image-20240525153247127.png)

# 六、ip地址划分

## 1.IP地址组成

ip地址：看上去是4个点分10进制数字，实际上是32位二进制数

```
二进制范围：00000000.00000000.00000000.00000000 -- 
11111111.11111111.11111111.11111111  
十进制范围：0.0.0.0 -- 255.255.255.255 
十六进制：0-9，a-f    a102
总共2^8 * 2^8 * 2^8 * 2^8，也就是2的32次方个数值，大概是将近43亿多个。   
1650这个十进制的计算方式可以写为：1*10^3 + 6*10^2 + 5*10^1 + 0*10^0 = 1000 + 600 + 50 + 0 = 1650
5这个十进制数字对应的二进制数字为101，转换为10进制的方式：1*2^2 + 0*2^1 + 1*2^0 = 4 + 0 + 1 = 5
同样，10进制可以转换为2进制
```

```
ip地址的总数约为43亿个，全球都用，导致ip地址不够用了，大家就想了个办法，将部分ip地址剥离出来给大家作为内部ip来使用，每个公司或者家庭的网络设备都用这些内部ip地址，然后大家共同使用一个公网ip来进行上网。

ip地址就分为内网ip地址和公网ip地址，内网ip地址又叫做私网ip地址，或者保留ip地址。
```

![image-20240525153411545](D:/%E6%96%87%E6%A1%A3/%E7%AC%94%E8%AE%B0/%E5%AD%A6%E6%A0%A1/Hadoop/image-20240525153411545.png)

```
那么只有公网ip地址可以上网，这时候就需要一个技术将内网ip地址转换为公网ip地址的技术，叫做
NAT(全称：Network Address Translation)，网络地址转换技术，这个技术就内置在了路由器上，所有请求数据包出网的时候，也就是发送到公网上的时候，都是从路由器出去的，都会被路由器上的NAT技术将数据包中的内网ip转换为公网ip。有了公网ip，数据包才能发送到网上去，才能实现互联网通信，也就是可以上网了。这样大家就可以共享一个公网ip来进行上网，ip个数不足的情况也明显得到了改善。因为从所有ip地址中剥离出来的这些内网ip地址，是所有公司或者说所有团体都可以在内部使用的。公网ip在互联网中是全世界唯一的，通过公网ip就能够找到精准的传输目标了。一个公网ip甚至都可以共享给上千万个设备来共享上网使用。
```

## 2.IP地址分类

```
a类  1.0.0.1~126.255.255.254  # 126*2^8   5.0.0.0 -- 5.255.255.255 
第一组：1-126开头的地址是A类
0<A类<127     
公网ip在这个地址段的居多，ping qq.com就可以看到58.250.137.36这就是个A类地址。
b类  128.0.0.1~191.255.255.254
 128<=B类<192    
c类  192.0.0.1~223.255.255.254  
# A类、B类、C类地址为三类主要的IP地址，下面两类我们基本见不到。

d类  组播，VRRP协议，keepalive高可用 224~239   
e类  科研 240-255  # 说是保留给科研用的

仔细看的话，可以看到a类和b类中间的127地址段没有划分上，127.0.0.1 - 127.255.255.255整个网段都是特殊地址，127开头的地址可以说是A类的保留地址，用作本地软件环回测试（loopback test）本主机的进程之间的通信而使用的。这个后面我们用到之后再提。
```

## 3.私有ip地址范围：

```
A类：10.0.0.0~10.255.255.255    # 通过网上的ip地址计算器，就能计算出这个网段有多少个ip地址， A类地址子网掩码是8位
		# 16777214

B类：172.16.0.0~172.31.255.255   # B类地址子网掩码是16位

C类：192.168.0.0~192.168.255.255  # 这个是我们经常看到的网段，内网中网络设备比较少的场景都用的这个，我们买路由器的时候，路由器上内置的网段多数也是这个网段。 # 65,536
```

## 4.为了缓解ipv4地址不够用的问题

```
解决办法：
    1：ipv6：fe80::2e60:cff:fe9c:a4b3   # 2^128次方的位数，这个数量就相当可观了。
在这种形式中，128位的IPv6地址被分为8组，每组的16位用4个十六进制字符（0～9，A～F）来
表示，组和组之间用冒号（:）隔开。比如IPv6地址2001:db8:130F:0000:0000:09C0:876A:130B，为了书写方便，每组中的前导“0”都可以省略，所以上述地址可写为：
    2001:db8:130F:0:0:9C0:876A:130B。  
	另外，地址中包含的连续两个或多个均为0的组，可以用双冒号“::”来代替，这样可以压缩IPv6地址书写时的长度，所以上述地址又可以进一步简写为：2001:db8:130F::9C0:876A:130B。
    2: NAT：network address transformation，网络地址转换
好处：
        a: 节约大量的公网ip地址
        b：减少了网络攻击
```

IPv6地址中的百分号是网卡interface标识。这个表示该地址仅限于标号为4的网络接口（一般指网卡或 者虚拟网卡）。而在其他网络接口这个地址是无效的。

![image-20240525153846940](D:/%E6%96%87%E6%A1%A3/%E7%AC%94%E8%AE%B0/%E5%AD%A6%E6%A0%A1/Hadoop/image-20240525153846940.png)

# 七、子网掩码的作用

## 1.概念

```
ip地址分为两个部分
    网络部分：标识子网，也就是网络位或者说网段
    主机部分：标识主机
　　注意：单纯的ip地址段只是标识了ip地址的种类，从网络部分或主机部分都无法辨识一个ip所处的子网

例：172.16.10.1与172.16.10.2并不能确定二者处于同一子网

所谓"子网掩码"，就是表示子网络特征的一个参数。它在形式上等同于IP地址，也是一个32位二进制数字，它的网络部分全部为1，主机部分全部为0。比如，IP地址172.16.10.1，如果已知网络部分是前24位，主机部分是后8位，那么子网络掩码就是11111111.11111111.11111111.00000000，写成十进制就是255.255.255.0
```

子网掩码：决定了一个网段的大小，网段大小决定了有多少个ip地址可以用，网段越大，ip地址越多

```
ip地址：192.168.2.110  子网掩码：255.255.255.0 
上面两个还有一个等效的写法：192.168.2.110/24
```

```
192.168.2.118/24  
10.0.0.0/8  
172.16.0.0/16
 # 怎么确定网段的大小呢，就要看子网掩码，8位、16位、24位等就是代表子网掩码的值的。数字越小的，表示网段越大。
```

## 2.子网掩码计算网段大小

```
首先知道"子网掩码"，我们就能判断，任意两个IP地址是否处在同一个子网络。方法就是将两个IP地址与子网掩码分别进行二进制的AND运算，也叫与运算（两个数位都为1，运算结果为1，否则为0），然后比较结果是否相同，如果是的话，就表明它们在同一个子网络中，否则就不是。
```

```
比如，已知IP地址172.16.10.1和172.16.10.2的子网掩码都是255.255.255.0，请问它们是否在同一个
子网络？两者与子网掩码分别进行AND运算:
    172.16.10.1：
   10101100.00010000.00001010.00000001
    255.255.255.0： 11111111.11111111.11111111.00000000  
两个
    AND运算得网络地址结果：10101100.00010000.00001010.00000000->172.16.10.0
    
    172.16.10.2：10101100.00010000.00001010.000000010
    255.255.255.0：11111111.11111111.11111111.00000000
    AND运算得网络地址结果：10101100.00010000.00001010.000000001->172.16.10.0
	计算得到的172.16.10.0，就说明这个网段是172.16.10.x。

# 255.255.255.0前面的255.255.255对应二进制就是24个1，也就是对应的ip地址的前面24位是不
变的，那么ip地址的这24位就是网络位，剩余的8位是主机位，网络位不变，主机位是可变的，可变的ip数量就是这个网段的ip地址数量，共2的8次方=256个，就可以写为172.16.10.1/24。

# 但是172.16.10.0和172.16.10.255都被保留下来不让主机使用，172.16.10.0作为网络号，通过网络号可以找到这个网络号对应网段的网络了，172.16.10.255是广播地址，这个广播地址我们一会说。也就是可用ip地址个数位256-2=254个。

所以ip协议有两个作用，一个是为每一台计算机分配IP地址，另一个是确定哪些地址在同一个子网络。
```

同一个网段的ip地址，物理线路接通就可以直接相互通信，不同网段的ip地址，即便是物理线路接通， 也不可以直接通信，需要路由器才能相互通信！路由器能够帮我们转发给对应网段的主机

```
11111111.11111111.11111111.10000000   255.255.255.128  

192.168.100.126/25  ---> ip地址：192.168.100.126  子网掩码：255.255.255.128
 192.168.100.129/25  ---> ip地址：192.168.100.129  子网掩码：255.255.255.128
 # 网络位25位，主机位7位，说明网段又小了。那么这两个ip地址能不能直接通信呢？
192.168.100.126 --> 11000000 10101000 01100100 01111110
 		11111111 11111111 11111111 10000000
				逻辑与计算，结果：
				192.168.100.0
 192.168.100.129 --> 11000000 10101000 01100100 10000001
 		11111111 11111111 11111111 10000000
				逻辑与计算，结果：
				192.168.100.1
				
             # 计算结果不同，不在一个网段
```

# 八、路由器(ikuai)

```
软件路由器：软路由
硬件路由器：普通路由器
企业路由器：企业级路由器
家用路由器一般比较便宜
```

![image-20240525155705500](D:/%E6%96%87%E6%A1%A3/%E7%AC%94%E8%AE%B0/%E5%AD%A6%E6%A0%A1/Hadoop/image-20240525155705500.png)

# 九、DNS解析流程

## 1.DNS的定义和由来

```
dns：全称domain name system域名系统

作用：将域名解析成ip地址

计算机和计算机之间通信是通过ip:端口来实现的。

比如：192.168.19.36:51000 <----> 192.168.19.40:80

服务端的某些服务程序的端口一般是固定的，客户端根据ip和端口进行连接通信，客户端的ip是固定
的，但是端口一般是系统随机分配的。
```

```
ip地址这个东西其实很难记得住，一个两个还行，多了根本记不住。而且如果某个网站的ip地址变了，那么就要重新记忆一下这个ip地址，导致ip地址这个东西其实轻易不能变，变了别人找不到你的网站了。后来就有个人开发了一套程序，这个程序就类似于一个电话本
# 网站姓名  对应的ip地址
baidu.com    111.22.31.2
bilibili.com 221.22.13.1
 ...
然后它访问某个网站的时候，就让浏览器自动来读取这个电话本，自动帮他找到名字对应的ip地址来进行访问。这个电话本至今还保留着，windows里面就C:\Windows\System32\drivers\etc\hosts文件。
```

![image-20240525155831095](D:/%E6%96%87%E6%A1%A3/%E7%AC%94%E8%AE%B0/%E5%AD%A6%E6%A0%A1/Hadoop/image-20240525155831095.png)

### 常用的DNS服务器地址

```
国内：
    阿里云：
            223.5.5.5
            223.6.6.6
    百度：  
            180.76.76.76
    腾讯：
            119.29.29.29
    南京信风：
                114.114.114.114  # 广告多，https://www.landiannews.com/archives/18431.html
国外
	谷歌：
 		8.8.8.8
```

## 2.DNS的解析流程

```
linux上的dns相关命令: # 下面这几个指令都可以查看DNS解析信息
dig              dig @180.76.76.76 www.hc39.com  
nslookup       nslookup www.hc39.com  180.76.76.76
host           host www.baigui.cloud  114.114.114.114
ping  www.baidu.com

# 示例1：通过nslookup可以查询
yum provides nslookup  # 查找之前可以先清除一下yum的缓存:yum clean all
yum install bind-utils -y
[root@localhost ~]# nslookup www.hc39.com
Server:     192.168.61.2
Address:    192.168.61.2#53  # 53：表示DNS服务程序的端口为53端口

Non-authoritative answer:
Name:   www.hc39.com
Address: 8.210.129.63
[root@localhost ~]# nslookup www.hc39.com 223.5.5.5
Server: 223.5.5.5
Address: 223.5.5.5#53

Non-authoritative answer:
Name:   www.hc39.com
Address: 8.210.129.63

[root@localhost ~]# nslookup www.hc39.com 180.76.76.76
Address:    180.76.76.76
Server:     180.76.76.76#53 

Non-authoritative answer:
Name:   www.hc39.com
Address: 8.210.129.63
# 通过上面各个DNS服务器的查询结果都是一样的。
```

**顺序**

```
1、找本机的hosts文件 Windows host文件路径： C:\WINDOWS\system32\drivers\etc\hosts 
,hosts文件以静态映射的方式提供IP地址与主机名的对照表。

2、浏览器缓存： 浏览器会按照一定的频率缓存DNS记录。浏览器地址栏输入chrome://netinternals/#dns，就可以查看chormeDNS缓存。

3、操作系统缓存： 如果浏览器缓存中找不到需要的DNS记录，那就去操作系统中找。cmd命令ipconfig /displaydns 用于查看操作系统dns缓存。ipconfig /flushdns刷新缓存，之前的记录就没了，只剩下一些固定的了。

4、路由缓存： 路由器也有DNS缓存。

5、去DNS本地服务器查找，自己公司搭建的或者阿里DNS服务器、百度DNS服务器等等

6、去根域名服务器上找，全世界有13台根域名服务器，其实我们的网址，比如www.hc39.com后面都有个点.，这个.代表根域名的意思，我们可以nslookup www.hc39.com. 发现还是可以查询到的，只不过这个.默认省略掉了。

7、根域名查不到的话，会直接下发本次请求给本地DNS服务器，并且把.com的顶级域名服务器地址发送给它，DNS服务器再向.com顶级域名服务器来进行查询。.com\.cn\.cloud等都是顶级域名服务器。

8、如果.com找不到的话，.com顶级域名服务器会给本地DNS服务器下发请求，并且给它hc39.com域名服务器的地址，意思就是说hc39这个域名下放给hc39这个域名所属公司的DNS服务器了，那么就去hc39.com域名服务器进行查询

9、查找到之后再还给你的电脑，你的电脑本地和路由器等都会自动缓存这些记录，下次再访问这个网站的时候，就从缓存中找，不然每次都按照流程找一遍就太慢了。


其实解析流程不仅仅是上面这种方式，上面的方式是递归查询，还有迭代查
询的方式，一般都是两种方式结合查询，
```

**注意**

```
所有的DNS服务器解析DNS的权利都是由它的上级DNS服务器授权的，最终是根服务器授权，这些权利 根服务器是可以回收来自己完成解析的。当年美军攻打伊拉克，让伊拉克在互联网上消失了，就玩了一 手DNS解析，将所有伊拉克的网站网址解析到了一个错误的ip地址上，别人都访问不了伊拉克的网站了。 

13个根域名服务器，其中1个为主根服务器在美国，由美国互联网机构Network Solutions运作。其余12个均为辅根服务器，其中9个在美国，2个在欧洲(位于英国和瑞典)，1个在亚洲(位于日本)。 

在与现有IPv4根服务器体系架构充分兼容基础上，"雪人计划"于2016年在全球16个国家完成25台IPv6根 服务器架设，事实上形成了13台原有根加25台IPv6根的新格局，为建立多边、民主、透明的国际互联网 治理体系打下坚实基础。中国部署了其中的4台，由1台主根服务器和3台辅根服务器组成，打破了中国过去没有根服务器的困境。所以中国现在主推ipv6。
```

## 3.域名

```
1.
是国家和地区顶级域名（country code top-level domains，简称ccTLDs），目前200多个国家都按照ISO3166国家代码分配了顶级域名，例如中国是cn，日本是jp等；

2.
是国际顶级域名（generic top-level domains，简称gTLDs），例如表示工商企业的 .com域名，表示网络提供商的 .net域名，表示非盈利组织的 .org域名等；

3.
是新顶级域名（New Generic Top-level Domain，简称New gTLD）如通用的.xyz域名、代表“高端”的.top域名、代表“红色”的.red域名、代表“人”的.men域名等一千多种。
从技术角度来看，一个完整的域名由顶级域名和下级域名构成，各部分之间用“.”隔开，最后一个“.”的右边被称为顶级域名（TLD，也称为一级域名），“.”左边的部分被称为二级域名，二级域名的左边是三级域名，以此类推。
为了便于理解和交流，我们通常会把域名分为前缀+后缀，后缀一般就是我们常见的.com/.cn/.cc/.net等等，这些都属于顶级域名，前缀则是由数字、字母自由组成的，用以和其他域名相区分的部分，这部分也是域名的核心价值所在。举个例子，中科三方的官网为http://www.sfn.cn，这其中.cn为顶级域名，也就是人们常说的后缀部分，.sfn则是其前缀的二级域名部分，代表的是中科三方这个品牌，最前面的.www则是前缀的三级域名部分，代表的是中科三方的官网。
二级域名的拥有者可以任意定义三级及三级以上的域名，比如小米公司花费两千万买下的http://mi.com这个二级域名后，他就可以根据其产品和业务再这个二级域名基础上无限定义三级域名或更高级的域名，比如，小米云服务：http://i.mi.com，小爱开放平台：http://xiaoai.mi.com，小米iot开发者平台：http://iot.mi.com，小米金融：http://jr.mi.com等等。一般情况下，除了政府相关网站外，很少有企业去定义三级以上的域名。
```

## 4.DNS记录的类型

```
A记录：域名对应一个ipv4的地址，通过dns查询这个域名就能得到对应ip地址  例如：
www.wulaoban.top  --  39.105.145.132

CNAME：也叫做域名别名，它将域名指向另外一个域名，你通过这个域名来进行DNS查询，那么得到的是另外一个域名，DNS查询会基于询问另外一个域名。 比如dig www.qq.com就能看到CNAME记录

MX：邮件记录，我们发邮件给1111@qq.com这个地址，那么首先会去找qq的邮箱服务器，就需要用到这个记录来找到服务器。windows上也自带nslookup指令，查询a记录：nslookup -qt=a qq.com，查询mx记录：nslookup -qt=mx qq.com，会看到几个域名，ping域名就看到ip地址了。qq.com有mx记录，说明

qq这个公司有自己的邮箱。如果某个公司没有自己的邮箱服务器，那么查不到信息。

NS：全称nameserver，可以指定DNS解析服务器的地址，在我们自己的域名解析记录上也可以设置自己DNS解析服务器，但是需要搭建DNS服务才行。

AAAA：ipv6地址，没啥说的。
```

### nslookup查询示例：

```
C:\Users\ls198>nslookup -qt=a qq.com
 DNS request timed out.
    timeout was 2 seconds.
服务器:  UnKnown
 Address:  192.168.2.1
 
非权威应答:
名称:    qq.com
 Addresses:  61.129.7.47
 183.3.226.35
 123.151.137.18
 
 
C:\Users\ls198>nslookup -qt=mx qq.com
DNS request timed out.
    timeout was 2 seconds.
服务器:  UnKnown
Address:  192.168.2.1

非权威应答:
 qq.com  MX preference = 10, mail exchanger = mx3.qq.com
 qq.com  MX preference = 30, mail exchanger = mx1.qq.com
 qq.com  MX preference = 20, mail exchanger = mx2.qq.com


C:\Users\ls198>ping mx1.qq.com
正在 Ping mx1.qq.com [113.96.208.206] 具有 32 字节的数据:
来自 113.96.208.206 的回复: 字节=32 时间=49ms TTL=53
来自 113.96.208.206 的回复: 字节=32 时间=47ms TTL=53
来自 113.96.208.206 的回复: 字节=32 时间=49ms TTL=53
来自 113.96.208.206 的回复: 字节=32 时间=48ms TTL=53
 113.96.208.206 的 Ping 统计信息:
数据包: 已发送 = 4，已接收 = 4，丢失 = 0 (0% 丢失)，
往返行程的估计时间(以毫秒为单位):
最短 = 47ms，最长 = 49ms，平均 = 48ms


C:\Users\ls198>nslookup -qt=mx wulaoban.top  # 没有邮箱地址
服务器:  UnKnown
 Address:  192.168.2.1
 wulaoban.top
        primary name server = dns19.hichina.com
        responsible mail addr = hostmaster.hichina.com
        serial  = 2022052002
        refresh = 3600 (1 hour)
        retry   = 1200 (20 mins)
        expire  = 86400 (1 day)
        default TTL = 600 (10 mins)


C:\Users\ls198>nslookup -qt=AAAA aliyun.com
 DNS request timed out.
    timeout was 2 seconds.
服务器:  UnKnown
Address:  192.168.2.1

非权威应答:
名称:    aliyun.com
Addresses:  2401:b180:1:60::5
		   2401:b180:1:60::6
```

# 十、ARP协议

## 1.概念

```
ARP（Address Resolution Protocol），工作在网络层和数据链路层中间。osi七层模型中，属于数据链 路基层的。 

作用：把ip地址解析成mac地址
```

![image-20240526201341365](D:/%E6%96%87%E6%A1%A3/%E7%AC%94%E8%AE%B0/image-20240526201341365.png)

抓包看到如下效果，如果没看到就重新再抓一下，我们下面抓取到的数据包顺序其实也不太对，应该是 先看到Broadcast广播arp请求，

![image-20240526201436937](D:/%E6%96%87%E6%A1%A3/%E7%AC%94%E8%AE%B0/image-20240526201436937.png)

广播的mac地址全是f，交换机就知道你不知道对方的mac地址，那么交换机就发广播了：

![image-20240526201543860](D:/%E6%96%87%E6%A1%A3/%E7%AC%94%E8%AE%B0/image-20240526201543860.png)

![image-20240526201624020](D:/%E6%96%87%E6%A1%A3/%E7%AC%94%E8%AE%B0/image-20240526201624020.png)

**ICMP协议**是ping发送探测数据包采用的协议，ARP是B主机发送给交换机的ARP广播请求，交换机会发 一个arp协议的Broadcast广播，问插在交换机上的所有主机，谁是的ip地址是 192.168.61.139 ，把 mac地址告诉 192.168.61.135 主机。所以其实两台主机想通信，其实还必须要知道对方的mac地址才 可以。如果我们ping过之后，arp广播请求也已经发送了，那么再次ping抓包的时候可能就看不到arp广 播了，因为arp广播是有缓存时效的，比如windows的arp超时时间Reachable Time是一个介于15秒~45 秒之间的随机值，这个通过修改注册表也是可以改的。为什么会有时效性呢，因为每个主机的ip地址是 会发生变化的，比如可以自行指定ip地址，如果arp广播的时效性太长，那么就没办法连通了。

**windows下通过 arp -a 可以查看arp缓存：**

![image-20240526201723976](D:/%E6%96%87%E6%A1%A3/%E7%AC%94%E8%AE%B0/image-20240526201723976.png)

## 2.注意

```
a：arp欺骗，广播的时候计算机默认是诚实的，但是如果它不诚实就可以做欺骗。
b：如果局域网规模太大，广播风暴
```

**arp欺骗，属于局域网的一种攻击手段，但是win10及以上的系统基本已经没有用了：看黄色的线**

![image-20240526201821746](D:/%E6%96%87%E6%A1%A3/%E7%AC%94%E8%AE%B0/image-20240526201821746.png)

现在有很多专门的arp安全工具，比如360的arp防火墙。也叫做局域网防护

## 3.广播风暴

```
如果交换机连接的主机太多，那么一次广播就很耗资源，如果广播次数很多，那么就容易造成网络堵
塞。

解决方法：路由器配合ip地址段来进行广播域的划分。路由器的内网ip地址，也就是我们ipconfig查看到的网关ip地址一般是网段的第一个ip或者最后一个ip，比如192.168.19.1或者192.168.19.254。
```

# 十一、tcpdump抓包

```bash
tcpdump -i eth0 icmp  -nn

-i 指定网卡的名称 
-nn 不把端口解析成应用层协议 
-c  指定抓包的数量 
-S  不把随机序列和确认序列解析成绝对值 
-w  指定数据包保存的位置
```

tcpdump抓的包，wireshark分析 

```
tcpdump -i e tcp port 22 -nn -c 20 -w ssh.cap
```

# 十二、linux的网络命令

```bash
nmap 扫描端口，黑客喜欢用 
nmap  192.168.19.88  -sV 
nmap -p1-5000 192.168.19.88

traceroute  -n www.qq.com （linux） 
tracert -d www.qq.com     （windows）

122.71.224.1    外网网关 
222.35.254.253  北京市铁通 
61.233.9.213    北京市铁通 
61.237.126.242 
61.237.127.238  中国铁通 
202.97.63.246   广东广州电信 
119.147.219.250 广东深圳电信 
183.3.226.35    腾讯服务器
```

# 十三、修改网卡配置文件

## 1.路径

```bash
/etc/sysconfig/network-scripts/ifcfg-ens33
```

## 2.修改

```bash
 #默认配置
TYPE="Ethernet"
PROXY_METHOD="none"
BROWSER_ONLY="no"
BOOTPROTO="dhcp"
DEFROUTE="yes"
IPV4_FAILURE_FATAL="no"
IPV6INIT="yes"
IPV6_AUTOCONF="yes"
IPV6_DEFROUTE="yes"
IPV6_FAILURE_FATAL="no"
IPV6_ADDR_GEN_MODE="stable-privacy"
NAME="ens33"
UUID="15723721-cab7-40f6-bcee-4789906f8661"
DEVICE="ens33"
ONBOOT="yes"

#修改后的配置
TYPE="Ethernet"        
#以太网类型
BOOTPROTO="static"     
NAME="ens33"           
DEVICE="ens33"         
ONBOOT="yes"           
守夜人Jaden-吴老板
#dhcp自动获取 none,static手动配置
#网络的名字
#网卡的名字
#开机自启
IPADDR=192.168.202.206 #ip地址
NETMASK=255.255.255.0  #子网掩码
GATEWAY=192.168.202.2  #网关
DNS1=223.5.5.5         
#dns1
DNS2=180.76.76.76      
#dns2
```

## 3.生效

```bash
systemctl restart network
 systemctl stop NetworkManager
 systemctl disable NetworkManager
```

# 十四、上不了网排查思路：

## 1.xshell连不上的原因

```
1.检查虚拟机的网络适配器，是否连接，是否为nat模式
2.检查VMware Network Adapter VMnet8是否处于禁用状态
3.VMnet8网卡的ip地址是否和虚拟机同一个网段
4.检查虚拟机的ip是否正常
```

## 2.xshell能连，但是上不了网

```bash
#GATEWAY关键字写错了，报错如下
[root@network02 ~]# ping baidu.com
ping: baidu.com: 未知的名称或服务
[root@network02 ~]# ping 223.5.5.5
connect: 网络不可达

#GATEWAY地址写错了，或者网关路由器挂了
[root@network02 ~]# ping 223.5.5.5
PING 223.5.5.5 (223.5.5.5) 56(84) bytes of data.

#能ping通公网ip，ping不通域名，dns地址有问题
[root@network02 ~]# ping www.baidu.com
 ^C
[root@network02 ~]# ping 223.5.5.5
PING 223.5.5.5 (223.5.5.5) 56(84) bytes of data.
64 bytes from 223.5.5.5: icmp_seq=1 ttl=128 time=14.4 ms
64 bytes from 223.5.5.5: icmp_seq=2 ttl=128 time=6.08 ms
```

## 3.物理机上不网

```bash
第一步：检查物理是否正常
第二步：ping网关 
第三步: ping公网ip 
第四步：ping www.baidu.com 
tracert -d www.qq.com  
第五步：ping 自己服务器
```

# 十五、静态路由项目

```bash
a：手动配置ip 
b：克隆虚拟机
echo 'net.ipv4.ip_forward = 1' >>/etc/sysctl.conf 
sysctl -p

route add -net 172.16.1.0/24  gw 192.168.20.12

route add -net 192.168.20.0/24 gw 172.16.1.12


`route add -net 172.16.1.0/24 gw 192.168.20.12` 命令的解释如下：
- `route`: 这是Linux系统中的一个命令，用于操作IP路由表。
- `add`: 这是`route`命令的一个选项，表示添加一个新的路由规则。
- `-net 172.16.1.0/24`: 这是指定要添加的路由规则的网络地址和子网掩码。`172.16.1.0/24`表示网络地址是172.16.1.0，子网掩码是255.255.255.0（/24表示前24位是网络地址，后8位是主机地址）。
- `gw 192.168.20.12`: 这是指定该路由规则的网关地址。所有发往172.16.1.0/24网络的数据包都将通过192.168.20.12这个网关地址进行转发。
```

# 十六、使用iptables实现nat上网

```bash
network02： 
a：添加网关10.0.0.254，使network02能够访问外网 
GATEWAY=10.0.0.254

b:配置iptable的NAT规则 
iptables -t nat -F  
iptables -t nat -A POSTROUTING -s 172.16.0.0/24 -j MASQUERADE 
-t  nat 指定nat表 
-A  POSTROUTING链  数据包离开的时候，做修改 
-s  源ip或者源ip段 
-j  MASQUERADE 指定动作为，模拟路由器的外网ip 10.0.0.12

c:开启内核转发参考 
echo 'net.ipv4.ip_forward = 1' >>/etc/sysctl.conf 
sysctl -p

network03： 
a：添加网关172.16.0.12，使network03能够访问外网
```

# 十七、linux的dhcp服务

```bash
#1.安装dhcp
yum install dhcp -y

#2.修改dhcp服务端的配置文件
vim /etc/dhcp/dhcpd.conf
#......
 subnet 172.16.0.0 netmask 255.255.255.0 {
  range 172.16.0.100 172.16.0.250;
  option domain-name-servers 180.76.76.76;
  option routers 172.16.0.12;
  default-lease-time 600;
  max-lease-time 7200;
 }

#3.启动dhcp服务端
systemctl start dhcpd.service 
systemctl enable dhcpd.service
```

# 十八、端口映射

```
作用：实现从外网访问内网的服务
```

# 十九、文字编码

```
# 我们要将生活中现实的情况转换到计算机的世界，叫做建模，比如我们常用的文字，要进入到计算机中使用，下面这些编码就是用来表示文字的。

ASCII码 #每个数字和字母都占1个字节，不支持中文，00000000000000--11111111总共可以涵盖256种符号，包含大小写英文、特殊符号等

GB2312 #每个数字和字母都占1个字节，中文占2个字节，但是可以涵盖的应为只有6700多个  

GBK  #升级版的GB2312，涵盖的中文2w多个和800多个特殊符号，中文基本全部涵盖了

Unicode #其他国家也有自己的文字，每个国家都需要自己的编码，并且这些国家都需要互联网通信，这怎么搞，那么就有一个组织将全世界的文字编码全部收集起来了，然后重新编码，这个编码叫做万国码，
Unicode。两个字节表示不了全世界的那么多国家的语言了，所以变成了4个字节来容纳这些文字编码。
utf-8  #在这种情况下，老美不愿意，我们自己的编码占用一个字节，现在硬盘空间莫名其妙的大了4倍，这就不太合理。
于是基于万国码推出了可变长编码，utf-8：一个英文一个字节，一个汉字三个字节。现在全世界用的最多的编码形式。
运行到内存中的程序数据编码都是万国码，所以什么语言的数据都不会乱码，但是我们如果非要自己指定gbk等编码，那么就可能要出现乱码了。
```

```
窗前明月光
utf-8: 每个汉字三个字节，比如窗：11010011 10101010 11100101，前：11111000 10010010 
10001001
转换为GK2312之后，11010011 10101010 11100101 11111000 10010010 10001001，两个字节一个汉字就显示出上面的文字了



GB2312，虽然打开之后也是进入了内存，但是我们自己指定了GB2312编码，所以就不会用内存默认的
unicode编码，就乱码了。
```

